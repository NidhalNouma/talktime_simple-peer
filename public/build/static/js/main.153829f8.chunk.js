(this.webpackJsonptalktime=this.webpackJsonptalktime||[]).push([[0],{41:function(e,t,n){},83:function(e,t){},85:function(e,t){},92:function(e,t){},93:function(e,t,n){"use strict";n.r(t);var c=n(0),r=n.n(c),o=n(33),s=n.n(o),a=(n(41),n(34)),i=n.n(a),l=n(3),u=n(13),j=n.n(u),f=n(1);var b=function(e){var t=e.stream,n=e.lstream,r=Object(c.useState)(new j.a),o=Object(l.a)(r,1)[0],s=Object(c.useState)(new j.a),a=Object(l.a)(s,1)[0],i=Object(c.useState)(0),u=Object(l.a)(i,2),b=u[0],d=u[1],O=Object(c.useRef)(null);return Object(c.useEffect)((function(){var e=setTimeout((function(){d((function(e){return e+1}))}),1e3);return function(){return clearTimeout(e)}}),[b]),Object(c.useEffect)((function(){return t&&t.active&&o.fromStream(t,"wave",{type:"shine",colors:["rgba(149, 54, 64,1)","white","blue"]}),n&&n.active&&a.fromStream(n,"lwave",{type:"shine",colors:["rgba(45, 134, 233, 1)","white","blue"]}),console.log("Start streaming audio ...,",t),O.current.srcObject=t,function(){o.stopStream(),a.stopStream()}}),[]),Object(f.jsxs)("div",{children:[Object(f.jsx)("canvas",{id:"wave"}),Object(f.jsx)("br",{}),Object(f.jsx)("canvas",{id:"lwave"}),Object(f.jsx)("audio",{ref:O,style:{display:"none"},volume:"true",autoPlay:!0})]})},d=n(35),O=n.n(d),m=n(36),g=n.n(m);var v=function(e,t){var n=Object(c.useState)(),r=Object(l.a)(n,2),o=r[0],s=r[1],a=Object(c.useState)(),i=Object(l.a)(a,2),u=i[0],j=i[1],f=Object(c.useState)(!1),b=Object(l.a)(f,2),d=b[0],m=b[1],v=Object(c.useState)(null),h=Object(l.a)(v,2),p=h[0],y=h[1],x=Object(c.useRef)();return Object(c.useEffect)((function(){1===e?(console.log("111 ",p),y(new g.a({url:"ws://localhost:8080"})),console.log("start ...")):0===e&&(m(!1),p&&(p.send(JSON.stringify({type:"end"})),p.destroy(),y(null),x.current&&(x.current.destroy(),x.current=null),console.log("ERROR send end")))}),[e]),Object(c.useEffect)((function(){if(p){var e,n=function(e){e&&e.preventDefault&&e.preventDefault(),x.current&&(console.log("ok"),p&&p.connected&&p.send(JSON.stringify({type:"end"})),x.current.destroy(),t()),p&&p.connected&&p.send(JSON.stringify({type:"peer"}))};console.log(p),p.on("error",(function(e){console.error("[socket error]",e.stack||e.message||e)})),p.once("connect",(function(){navigator.mediaDevices.getUserMedia({audio:!0}).then((function(t){e=t,s(t),console.log("stream ,",t),n()})).catch((function(e){console.log(e.message),window.alert("You must share your webcam to use this app!")}))})),p.on("data",(function(t){console.log("got socket message: "+t);try{t=JSON.parse(t)}catch(r){console.error("[socket error]",r.stack||r.message||r)}var c;"signal"===t.type?(c=t.data,x.current.signal(c)):"count"===t.type?console.log(t.data):"end"===t.type?n():"peer"===t.type&&function(t){t=t||{},x.current=new O.a({initiator:!!t.initiator,stream:e}),x.current.on("error",(function(e){console.error("peer error",e.stack||e.message||e)})),x.current.on("connect",(function(){m(!0)})),x.current.on("signal",(function(e){p.send(JSON.stringify({type:"signal",data:e}))})),x.current.on("stream",(function(e){j(e)})),x.current.on("data",(function(e){})),x.current.on("close",n)}(t.data)}))}}),[p]),{lstream:o,rstream:u,startCall:d}};var h=function(e){var t=e.type,n=void 0===t?0:t,r=e.answer,o=e.close,s=v(n,o),a=s.lstream,l=s.rstream,u=s.startCall;return Object(c.useEffect)((function(){0===n&&(p(a),p(l))}),[n]),Object(c.useEffect)((function(){u&&r()}),[u]),1===n?Object(f.jsx)(i.a,{type:"Bars",color:"rgba(102, 193, 113, 1)",height:80,width:80}):2===n&&l?Object(f.jsx)(b,{stream:l,lstream:a}):Object(f.jsx)("div",{})};function p(e){e&&e.getTracks().forEach((function(t){t.stop(),console.log("st",e)}))}var y=function(){var e=Object(c.useState)(0),t=Object(l.a)(e,2),n=t[0],r=t[1],o=Object(c.useState)("Call"),s=Object(l.a)(o,2),a=s[0],i=s[1];return{state:n,click:function(){0===n&&(r(1)||i("Dialling")),1===n&&(r(0)||i("Call")),2===n&&(r(0)||i("Call"))},btnText:a,answer:function(){console.log("answer call ..."),r(2),i("End")},close:function(){console.log("call closed ..."),r(0),i("Call")}}};var x=function(){var e=y(),t=e.state,n=e.click,c=e.btnText,r=e.answer,o=e.close;return Object(f.jsxs)("div",{className:"App",children:[Object(f.jsx)("div",{className:"logo",children:Object(f.jsx)("h4",{children:"TalkTime"})}),Object(f.jsx)("div",{children:Object(f.jsx)("h5",{children:"Find someone to talk to."})}),Object(f.jsx)("div",{className:"audio-animation",children:Object(f.jsx)(h,{type:t,answer:r,close:o})}),Object(f.jsx)("div",{className:"button",children:Object(f.jsx)("button",{onClick:n,className:c,children:c})}),Object(f.jsxs)("div",{className:"footer",children:[Object(f.jsx)("a",{href:"/privacy",children:"Privacy Policy"})," | ",Object(f.jsx)("a",{href:"/terms",children:"Terms"})]})]})},w=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,94)).then((function(t){var n=t.getCLS,c=t.getFID,r=t.getFCP,o=t.getLCP,s=t.getTTFB;n(e),c(e),r(e),o(e),s(e)}))};s.a.render(Object(f.jsx)(r.a.StrictMode,{children:Object(f.jsx)(x,{})}),document.getElementById("root")),w()}},[[93,1,2]]]);
//# sourceMappingURL=main.153829f8.chunk.js.map